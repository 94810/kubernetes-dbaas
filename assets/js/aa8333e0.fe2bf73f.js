"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[398],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return g}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(n),g=o,m=d["".concat(s,".").concat(g)]||d[g]||p[g]||i;return n?r.createElement(m,a(a({ref:t},c),{},{components:n})):r.createElement(m,a({ref:t},c))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var u=2;u<i;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5757:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var r=n(7462),o=n(3366),i=(n(7294),n(3905)),a=["components"],l={sidebar_position:5},s="Logging & troubleshooting",u={unversionedId:"operator-configuration/logging-monitoring",id:"operator-configuration/logging-monitoring",isDocsHomePage:!1,title:"Logging & troubleshooting",description:"Overview",source:"@site/docs/operator-configuration/logging-monitoring.md",sourceDirName:"operator-configuration",slug:"/operator-configuration/logging-monitoring",permalink:"/kubernetes-dbaas/docs/operator-configuration/logging-monitoring",editUrl:"https://github.com/bedag/kubernetes-dbaas/edit/main/website/docs/operator-configuration/logging-monitoring.md",version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Credential rotation",permalink:"/kubernetes-dbaas/docs/operator-configuration/credential-rotation"},next:{title:"CLI arguments",permalink:"/kubernetes-dbaas/docs/operator-configuration/cli-arguments"}},c=[{value:"Overview",id:"overview",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[{value:"Example of event",id:"example-of-event",children:[]}]},{value:"Sampling",id:"sampling",children:[]},{value:"Metrics",id:"metrics",children:[]},{value:"Additional information",id:"additional-information",children:[]}],p={toc:c};function d(e){var t=e.components,n=(0,o.Z)(e,a);return(0,i.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"logging--troubleshooting"},"Logging & troubleshooting"),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"By default ",(0,i.kt)("inlineCode",{parentName:"p"},"--debug")," is set to false, in this case the production logger is initialized.\nIf ",(0,i.kt)("inlineCode",{parentName:"p"},"--debug")," is set to true the development logger is initialized instead."),(0,i.kt)("p",null,"The development logger has pretty printing, suited for command-line consumption."),(0,i.kt)("p",null,"The production logger has JSON output and sampling."),(0,i.kt)("p",null,"Make sure to have a look at ",(0,i.kt)("a",{parentName:"p",href:"/docs/operator-configuration/cli-arguments"},"CLI arguments"),"."),(0,i.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,i.kt)("p",null,"You can troubleshoot problems in two ways:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Look at the events of the resource with ",(0,i.kt)("inlineCode",{parentName:"li"},"kubectl describe db my-database-resource ")),(0,i.kt)("li",{parentName:"ol"},"Consult the logs of the manager pod.")),(0,i.kt)("p",null,"To avoid leaking possibly sensitive information, events do not contain the full error description, they contain a message along with some helpful values, if present.\nThus, you should refer to the logging output if you need to obtain deeper information about the problem."),(0,i.kt)("p",null,"You can control the verbosity of the logger by setting the ",(0,i.kt)("inlineCode",{parentName:"p"},"--log-level <int>")," flag."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"0"),": Info level"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"1"),": Debug Level"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"2"),": Trace level")),(0,i.kt)("p",null,"Errors are always logged."),(0,i.kt)("h3",{id:"example-of-event"},"Example of event"),(0,i.kt)("p",null,"The following shows what is written to the Database resource when it is written to the cluster and the relative DB instance\nis provisioned successfully on the DBMS endpoint:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'Type    Reason                    Age     From                   Message\n----    ------                    ----    ----                   -------\nNormal  DatabaseCreateInProgress  1s      database-controller    database instance is being provisioned on dbms endpoint\nNormal  DatabaseCreateSuccess     1s      database-controller    database instance provisioned successfully on dbms endpoint\nNormal  SecretCreateSuccess       1s      database-controller    secret created successfully: {"secret": "database-sample-789-credentials"}\n')),(0,i.kt)("h2",{id:"sampling"},"Sampling"),(0,i.kt)("p",null,"Sampling is enabled in production mode for every log entry with same level and message. The first 100 entries in one second\nare logged, after that only one entry is logged every 100 entries until the next second."),(0,i.kt)("h2",{id:"metrics"},"Metrics"),(0,i.kt)("p",null,"Metrics are information related to the operational status of the Operator, e.g. how much memory it\nconsumes. A ServiceMonitor resource is included, which enables Prometheus to scrape metrics from the\nOperator. Metrics are written to the ",(0,i.kt)("inlineCode",{parentName:"p"},"/metrics")," endpoint of the Operator."),(0,i.kt)("p",null,"Metrics are protected using ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/brancz/kube-rbac-proxy"},"kube-rbac-proxy"),", a small HTTP proxy that can perform RBAC authorization\nagainst the Kubernetes API. It is deployed alongside the controller, acting as a proxy for inbound requests."),(0,i.kt)("p",null,"See also the ",(0,i.kt)("a",{parentName:"p",href:"https://book.kubebuilder.io/reference/metrics.html"},"kubebuilder documentation")," about metrics."),(0,i.kt)("h2",{id:"additional-information"},"Additional information"),(0,i.kt)("p",null,"Stacktraces can be enabled by setting the flag ",(0,i.kt)("inlineCode",{parentName:"p"},"--enable-stacktrace")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),". Defaults to ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," in debug mode."))}d.isMDXComponent=!0}}]);